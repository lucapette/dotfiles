#!/usr/bin/env ruby
# encoding: UTF-8

info = `ioreg -rc "AppleSmartBattery"`

battery = %w(ExternalConnected CurrentCapacity MaxCapacity IsCharging).inject({}) do |hash, property|
  hash[property.to_sym] = info[/"#{property}" = (.*)$/, 1]; hash
end

percentage = (battery[:CurrentCapacity].to_f / battery[:MaxCapacity].to_f * 100).to_i
is_charging = battery[:IsCharging] == "Yes"
is_plugged_in = battery[:ExternalConnected] == "Yes"


color = if is_charging
         "#[fg=yellow]"
        elsif percentage > 60
          "#[fg=green]"
        elsif percentage > 20
         "#[fg=yellow]"
        else
          "#[fg=red]"
        end

output = color + "#{percentage}%"

puts output += "#[fg=reset]"
